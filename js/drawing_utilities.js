function initializeSketchpad(){function e(e){let t=0,a=0;for(;e;)t+=parseInt(e.offsetTop),a+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:a}}function t(e){let t=null;switch(e.type){case"mousedown":e.touches=[],e.touches[0]={pageX:e.pageX,pageY:e.pageY},t="touchstart";break;case"mousemove":e.touches=[],e.touches[0]={pageX:e.pageX,pageY:e.pageY},t="touchmove";break;case"mouseup":e.touches=[],e.touches[0]={pageX:e.pageX,pageY:e.pageY},t="touchend"}let a;a="touchend"===e.type?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}:{x:e.touches[0].pageX,y:e.touches[0].pageY},t=t||e.type,i[t](a)}let a,n=document.getElementById("sketchpad"),o=n.getContext("2d"),r=e(n),c=!1;window.clearSketchpad=function(){o.clearRect(0,0,280,280),c=!1},window.clearSketchpad();const i={isDrawing:!1,touchstart(e){o.beginPath(),o.lineWidth=20,o.lineCap="round",o.moveTo(e.x-r.left,e.y-r.top),this.isDrawing=!0},touchmove(e){if(this.isDrawing){try{clearTimeout(a)}catch(e){}c&&clearSketchpad(),o.lineTo(e.x-r.left,e.y-r.top),o.stroke()}},touchend(e){this.isDrawing&&(this.touchmove(e),this.isDrawing=!1)}};"createTouch"in document||"ontouchstart"in window?(n.addEventListener("touchstart",t,!1),n.addEventListener("touchmove",t,!1),n.addEventListener("touchend",t,!1)):(n.addEventListener("mousedown",t,!1),n.addEventListener("mousemove",t,!1),n.addEventListener("mouseup",t,!1)),window.addEventListener("resize",t=>{t.preventDefault();r=e(n)},!1),document.body.addEventListener("touchmove",e=>{e.preventDefault()},!1)}function centerImage(e){for(var t=0,a=0,n=e.length,o=e[0].length,r=0,c=0;n>c;c++)for(var i=0;o>i;i++){var s=1-e[c][i];r+=s,a+=c*s,t+=i*s}t/=r,a/=r;var g=Math.round(n/2-a);return{transX:Math.round(o/2-t),transY:g}}function getBoundingRectangle(e,t){for(var a=e.length,n=e[0].length,o=n,r=a,c=-1,i=-1,s=0;a>s;s++)for(var g=0;n>g;g++)e[s][g]<t&&(o>g&&(o=g),g>c&&(c=g),r>s&&(r=s),s>i&&(i=s));return{minY:r,minX:o,maxY:i,maxX:c}}function imageDataToGrayscale(e){for(var t=[],a=0;a<e.height;a++){t[a]=[];for(var n=0;n<e.width;n++){var o=4*a*e.width+4*n;0==e.data[o+3]&&(e.data[o]=255,e.data[o+1]=255,e.data[o+2]=255),e.data[o+3]=255,t[a][n]=e.data[4*a*e.width+4*n+0]/255}}return t}function convertDrawToArray(){const e=document.getElementById("sketchpad"),t=e.getContext("2d");let a=t.getImageData(0,0,280,280);grayscaleImg=imageDataToGrayscale(a);const n=getBoundingRectangle(grayscaleImg,.01),o=centerImage(grayscaleImg),r=document.createElement("canvas");r.width=a.width,r.height=a.height;const c=r.getContext("2d"),i=n.maxX+1-n.minX,s=n.maxY+1-n.minY,g=190/(i>s?i:s);c.translate(e.width/2,e.height/2),c.scale(g,g),c.translate(-e.width/2,-e.height/2),c.translate(o.transX,o.transY),c.drawImage(t.canvas,0,0),a=c.getImageData(0,0,280,280),grayscaleImg=imageDataToGrayscale(a),console.log(grayscaleImg);const d=Array(784),h=[];for(u=0;28>u;u++)for(m=0;28>m;m++){let e=0;for(let t=0;10>t;t++)for(let a=0;10>a;a++)e+=grayscaleImg[10*u+t][10*m+a];e=1-e/100,d[28*m+u]=(e-.5)/.5}t.clearRect(0,0,e.width,e.height),t.drawImage(c.canvas,0,0);for(var u=0;28>u;u++)for(var m=0;28>m;m++){const e=t.getImageData(10*m,10*u,10,10),a=255*(.5-d[28*m+u]/2);h.push(Math.round((255-a)/255*100)/100);for(let t=0;400>t;t+=4)e.data[t]=a,e.data[t+1]=a,e.data[t+2]=a,e.data[t+3]=255;t.putImageData(e,10*m,10*u)}return h}